<div *ngIf="tableChangedMsg" class="table-change-toast">
    {{tableChangedMsg}}
</div>
<div class="room-bg">
    <div class="room-card" *ngIf="tournament && player">
      <h1 class="room-title">Tournoi "{{tournament.nom}}"</h1>
  
      <!-- Bloc blindes, timer et infos tournoi -->
      <div class="blinde-row">
        <div class="blinde-info">
          <h3>Niveau actuel</h3>
          <div *ngIf="currentLevel">
            <span *ngIf="!currentLevel.is_pause">
              SB <b>{{currentLevel.sb}}</b> / BB <b>{{currentLevel.bb}}</b>
              <span *ngIf="currentLevel.ante">/ Ante <b>{{currentLevel.ante}}</b></span>
            </span>
            <span *ngIf="currentLevel.is_pause" class="pause-label">Pause</span>
          </div>
          <div class="timer-bar">
            <div class="timer-progress" [style.width.%]="timerPerc"></div>
          </div>
          <div class="timer-display">{{timerDisplay}}</div>
        </div>
        <div class="next-blinde-info" *ngIf="nextLevel">
          <h3>Niveau Suivant</h3>
          <span *ngIf="!nextLevel.is_pause">
            SB <b>{{nextLevel.sb}}</b> / BB <b>{{nextLevel.bb}}</b>
            <span *ngIf="nextLevel.ante">/ Ante <b>{{nextLevel.ante}}</b></span>
          </span>
          <span *ngIf="nextLevel.is_pause" class="pause-label">Pause</span>
          <div class="duration">({{nextLevel.duree}} sec)</div>
        </div>
      </div>
  
      <!-- Blocs infos joueur/table -->
      <div class="info-row" *ngIf="!eliminated">
        <div class="player-block">
          <h3>Joueur</h3>
          <div class="field-pseudo"><b>Pseudo :</b> <span>{{player.pseudo}}</span></div>
          <div><b>Table :</b> <span>{{player.table?.numero ?? '-'}}</span></div>
          <div><b>Siège :</b> <span>{{player.siege ?? '-'}}</span></div>
        </div>
        <div class="jetons-block">
          <h3>Jetons</h3>
          <ul>
            <li *ngFor="let j of tournament.jetons">
              <span class="jeton-dot" [style.background]="j.couleur"></span>
              <span>{{j.label || 'Jeton'}} : {{j.valeur}}</span>
            </li>
          </ul>
        </div>
      </div>
  
      <!-- Bloc leaderboard à l’élimination -->
      <div class="eliminated-block" *ngIf="eliminated">
        <h2>Vous êtes éliminé</h2>
        <div class="rank">Votre rang : <b>#{{rank}}</b></div>
        <div class="leaderboard-block">
          <h3>Classement du tournoi</h3>
          <ol>
            <li *ngFor="let p of leaderboard">
              <span>{{p.pseudo}}</span>
              <span *ngIf="p.is_out" class="out">(Éliminé)</span>
            </li>
          </ol>
        </div>
      </div>
  
      <div class="tournoi-stats">
        <div><b>Joueurs restants :</b> {{remainingPlayers}}</div>
        <div><b>Cash Prize :</b> {{cashPrize | number}} €</div>
        <div><b>Stack moyen :</b> {{averageStack | number}} jetons</div>
      </div>
  
      <!-- Structure complète des blindes -->
      <div class="structure-block">
        <h3>Structure des blindes</h3>
        <table>
          <tr>
            <th>Niv</th>
            <th>SB</th>
            <th>BB</th>
            <th>Ante</th>
            <th>Durée</th>
            <th>Pause</th>
          </tr>
          <tr *ngFor="let b of tournament.blind_levels">
            <td>{{b.niveau}}</td>
            <td>{{b.sb || '-'}}</td>
            <td>{{b.bb || '-'}}</td>
            <td>{{b.ante || '-'}}</td>
            <td>{{b.duree}}s</td>
            <td><span *ngIf="b.is_pause">✔️</span></td>
          </tr>
        </table>
      </div>
  
      <!-- Texas Hold’em : force des mains -->
      <div class="hands-block">
        <svg xmlns="http://www.w3.org/2000/svg" width="500" height="2000">
          <style>
            .title { font: bold 24px sans-serif; fill: #d10000; }
            .combo-title { font: bold 18px sans-serif; fill: #000; }
            .combo-desc { font: 14px sans-serif; fill: #333; }
            .example { font: 16px monospace; fill: #000; }
            .box { fill: #f0f0f0; stroke: #ccc; stroke-width: 1; rx: 10; ry: 10; }
          </style>
        
          <text x="20" y="40" class="title">Les combinaisons du Poker Texas Hold'em</text>
        
          <!-- Carte isolée -->
          <g transform="translate(20,70)">
            <rect width="460" height="100" class="box"/>
            <text x="20" y="30" class="combo-title">Carte Isolée</text>
            <text x="20" y="55" class="combo-desc">(carte la + forte)</text>
            <text x="20" y="80" class="example">Q♣️ K♠️ 7♥️ 10♦️ 9♥️</text>
          </g>
        
          <!-- Paire -->
          <g transform="translate(20,190)">
            <rect width="460" height="100" class="box"/>
            <text x="20" y="30" class="combo-title">Paire</text>
            <text x="20" y="55" class="combo-desc">(2 cartes identiques)</text>
            <text x="20" y="80" class="example">5♦️ 5♣️ 3♣️ 10♣️ 7♣️</text>
          </g>
        
          <!-- Double Paire -->
          <g transform="translate(20,310)">
            <rect width="460" height="100" class="box"/>
            <text x="20" y="30" class="combo-title">Double Paire</text>
            <text x="20" y="55" class="combo-desc">(2 + 2 cartes identiques)</text>
            <text x="20" y="80" class="example">5♦️ 5♣️ 3♣️ 10♣️ 10♠️</text>
          </g>
        
          <!-- Brelan -->
          <g transform="translate(20,430)">
            <rect width="460" height="100" class="box"/>
            <text x="20" y="30" class="combo-title">Brelan</text>
            <text x="20" y="55" class="combo-desc">(3 cartes identiques)</text>
            <text x="20" y="80" class="example">9♥️ 9♦️ 9♣️ 6♦️ 8♥️</text>
          </g>
        
          <!-- Suite -->
          <g transform="translate(20,550)">
            <rect width="460" height="100" class="box"/>
            <text x="20" y="30" class="combo-title">Suite</text>
            <text x="20" y="55" class="combo-desc">(5 cartes qui se suivent)</text>
            <text x="20" y="80" class="example">K♣️ Q♦️ J♠️ 10♠️ 9♥️</text>
          </g>
        
          <!-- Couleur -->
          <g transform="translate(20,670)">
            <rect width="460" height="100" class="box"/>
            <text x="20" y="30" class="combo-title">Couleur</text>
            <text x="20" y="55" class="combo-desc">(5 cartes de la même couleur)</text>
            <text x="20" y="80" class="example">J♦️ 10♦️ 5♦️ 3♦️ 4♦️</text>
          </g>
        
          <!-- Full -->
          <g transform="translate(20,790)">
            <rect width="460" height="100" class="box"/>
            <text x="20" y="30" class="combo-title">Full</text>
            <text x="20" y="55" class="combo-desc">(3 + 2 cartes identiques)</text>
            <text x="20" y="80" class="example">Q♣️ Q♥️ Q♦️ 8♥️ 8♦️</text>
          </g>
        
          <!-- Carré -->
          <g transform="translate(20,910)">
            <rect width="460" height="100" class="box"/>
            <text x="20" y="30" class="combo-title">Carré</text>
            <text x="20" y="55" class="combo-desc">(4 cartes identiques)</text>
            <text x="20" y="80" class="example">9♥️ 7♦️ 7♠️ 7♣️ 7♥️</text>
          </g>
        
          <!-- Quinte Flush -->
          <g transform="translate(20,1030)">
            <rect width="460" height="100" class="box"/>
            <text x="20" y="30" class="combo-title">Quinte Flush</text>
            <text x="20" y="55" class="combo-desc">(une suite de la même couleur)</text>
            <text x="20" y="80" class="example">J♦️ 10♦️ 9♦️ 8♦️ 7♦️</text>
          </g>
        
          <!-- Quinte Flush Royale -->
          <g transform="translate(20,1150)">
            <rect width="460" height="100" class="box"/>
            <text x="20" y="30" class="combo-title">Quinte Flush Royale</text>
            <text x="20" y="55" class="combo-desc">(A, K, Q, J, 10 de la même couleur)</text>
            <text x="20" y="80" class="example">A♣️ K♣️ Q♣️ J♣️ 10♣️</text>
          </g>
        </svg>        
      </div>
    </div>
    <!-- Si pas de tournoi ou pseudo pas trouvé -->
    <div class="room-card" *ngIf="tournament && !player">
      <h2>Joueur non trouvé</h2>
      <p>Votre pseudo est introuvable pour ce tournoi.<br>
      Vérifiez le code et le pseudo renseignés ou contactez l’organisateur.</p>
    </div>
  </div>